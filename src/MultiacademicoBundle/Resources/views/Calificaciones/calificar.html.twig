{% extends '::basesimple.html.twig' %}

{% form_theme form _self %}
{% block nota_widget %}
{% spaceless %}
    {%- set attr = attr|merge({class: (attr.class|default('') ~ ' form-control')|trim}) -%}
    {%- set type = type|default('number') -%}
    <input type="{{ type }}" {{ block('widget_attributes') }} {% if value is not empty %} value="{{ value|replace(',','.') }}" {% endif %}/>
{% endspaceless %}
{% endblock  %}

{%- block _multiacademicobundle_calificar_guardar_widget -%}
   {% set attr = attr|merge({class: (attr.class|default('btn-default') ~ ' btn')|trim}) %}
   {%- set type = type|default('submit') -%}
    {%- if label is empty -%}
        {%- if label_format is not empty -%}
            {% set label = label_format|replace({
                '%name%': name,
                '%id%': id,
            }) %}
        {%- else -%}
            {% set label = name|humanize%}
        {%- endif -%}
    {%- endif -%}
    <button type="{{ type|default('button') }}" {{ block('button_attributes') }}><i class="fa fa-floppy-o bigger-160"></i> {{ label|trans({}, translation_domain) }}</button>
{%- endblock -%}

{% block body -%}
    {#<script src="https://code.jquery.com/jquery-2.1.4.min.js">
     </script>#}   
      <link rel="stylesheet" href="{{asset('css/multiacademico.css')}}" />
     <div class="row">
    <div class=" col-md-12">

        <!-- Start inline form -->
        <div class="panel rounded shadow">
            <div class="panel-heading">
                <div class="pull-left">
                    <h3 class="panel-title"><i class="flaticon-canvas"></i> Calificaciones</h3>
                </div>
                <div class="pull-right">
                    <button data-tooltip data-collapse-panel class="btn btn-sm" data-container="body" data-action="collapse" data-toggle="tooltip" data-placement="top" data-title="Collapse"><i class="fa fa-angle-up"></i></button>
                    <button data-tooltip data-remove-panel class="btn btn-sm" data-container="body" data-action="remove" data-toggle="tooltip" data-placement="top" data-title="Remove"><i class="fa fa-times"></i></button>
                </div>
                <div class="clearfix"></div>
            </div><!-- /.panel-heading -->
            <div class="panel-body no-padding">

              <div class="row">
                  {{ form_start(form) }}
                        
                  
                        {# ... #}
                    <div class="row">
                        {# store the prototype on the data-prototype attribute #}
                        <table class="table" id="calificaciones-fields-list">
                            <thead class="thin-border-bottom">
                                <tr class="text-center center">
                                    <td colspan="5" style="vertical-align:middle">
                                        <div><b>Quimestre Activo: </b>
                                   <select value="2" onchange="busca_parcial();" >
                                       <option value="1">PRIMER QUIMESTRE</option>
                                       <option value="2">SEGUNDO QUIMESTRE</option>
                                       <option value="3">ANUAL</option></select> 
                                        </div>
                                        <div>
                                        <b>Parcial Activo: </b>
                                            <select value="3" onchange="busca_parcial();" >
                                                <option value="1">1er Parcial</option>
                                                <option value="2">2do Parcial</option>
                                                <option value="3">3er Parcial</option>
                                                <option value="4">Total Parciales</option>
                                                <option value="5">Totales Quimestre</option>
                                            </select></div>
                                    </td>
                                    <td colspan="9">
                                        <a href="">
                                            <button type="button" class="btn btn-app btn-primary "><i class="flaticon-a1 bigger-160"></i>Menu</button></a>
                                        
                                        {{form_widget(form.guardar)}}
                                        <a href="">
                                            <button type="button" class="btn btn-app btn-light "><i class="fa fa-print bigger-160"></i>Imprimir</button></a>
                                    </td></tr>
                                <tr><td colspan="4"><b>Curso: </b>{{curso}}</td>
                                    <td colspan="10"><b>Materia: </b>{{materia}} </td> 

                                </tr>
                                 <tr>    
                                     <th colspan="14">SEGUNDO QUIMESTRE</th>
                                  </tr> 
                                  <tr>


                                        <th rowspan="2">
                                                    <i class="ace-icon fa fa-file-text-o"></i>
                                                    Matricula
                                            </th>
                                            <th rowspan="2">
                                                    <i class="ace-icon flaticon-student"></i>	
                                                    Estudiante
                                            </th>

                                                  <th colspan="6" class="text-center">Tercer Parcial</th><th colspan="5" class="text-center hidden-480">Totales del Parcial</th>										
                                           </tr>


                                           <tr class="rotar-texto">
                                                <th class="rotar-texto" style="vertical-align:bottom">
                                                        <div class="letterP4">Tareas<br>Investigaciones</div></th>
                                                <th class="rotar-texto" style="vertical-align:bottom"><div class="letterP4">Actividades Individuales</div></th>
                                                <th class="rotar-texto" style="vertical-align:bottom"><div class="letterP4">Actividades<br>Grupales</div></th>
                                                <th class="rotar-texto" style="vertical-align:bottom"><div class="letterP4">&nbsp;&nbsp;&nbsp;Lecciones</div></th>
                                                <th class="rotar-texto" style="vertical-align:bottom"><div class="letterP4">EVALUACION SUMATIVA</div></th>
                                                <th class="rotar-texto" style="vertical-align:bottom"><div class="letterP4">&nbsp;&nbsp;&nbsp;PROMEDIO</div></th>
                                                {% if pactivo==3 %}
                                                <th class="rotar-texto" style="vertical-align:bottom"><div class="letterP4">PROMEDIO PARCIALES</div></th>
                                                <th class="rotar-texto" style="vertical-align:bottom"><div class="letterP4">&nbsp;&nbsp;&nbsp;PROMEDIO&nbsp;80%</div></th>
                                                <th class="rotar-texto" style="vertical-align:bottom"><div class="letterP4">&nbsp;&nbsp;&nbsp;EXAMEN</div></th>
                                                <th class="rotar-texto" style="vertical-align:bottom"><div class="letterP4">&nbsp;&nbsp;&nbsp;EXAMEN&nbsp;20%</div></th>
                                                <th class="rotar-texto" style="vertical-align:bottom"><div class="letterP4">&nbsp;&nbsp;&nbsp;NOTA&nbsp;QUIMESTRE</div></th>
                                                {%endif%}
                                            </tr>


                            </thead>
                            <tbody>
                            {%for calificacion in form.calificaciones %}
                                
                                <tr>
                                    <td>
                                         {%set nummat=listado[loop.index0].calificacionnummatricula.id %}    
                                         {%set notares='M'~nummat~'q'~qactivo~'P'~pactivo~'N' %}
                                         {%set promediopv='PM'~nummat~'q'~qactivo~'P'~pactivo %}
                                         {%set promediopt='PPTM'~nummat~'q'~qactivo %}
                                        {%set promediopt80='PPT80M'~nummat~'q'~qactivo %}
                                        {%set ppval=listado[loop.index0].getPromedioParcial(qactivo,pactivo)%}
                                        {%set pptval=listado[loop.index0].getPromedioParciales(qactivo)%}
                                          {{nummat }}
                                     </td>   
                                     <td>
                                            {{listado[loop.index0].calificacionnummatricula }}
                                     </td>
                                     {%for i in 1..5%}
                                     <td>
                                        <div style="display:flex">
                                         {%set notavar='q'~qactivo~'P'~pactivo~'N'~i %}
                                        {{ form_errors(calificacion[notavar]) }}
                                        {{ form_widget(calificacion[notavar],{'attr':
                                                                                    {'ng-model':'M'~nummat~notavar,
                                                                                     'ng-init':'M'~nummat~notavar~'='~(calificacion[notavar].vars.value|replace(',','.')),
                                                                                     'ng-change':promediopv~'=((('~notares~'1+'~
                                                                                                                notares~'2+'~
                                                                                                                notares~'3+'~
                                                                                                                notares~'4+'~    
                                                                                                                notares~'5)/5)|number:2);'~
                                                                                                 promediopt~'='~(pptval-(ppval/3))~'*1+'~promediopv~'/3;'
                                                                                                    
                                                                                    }
                                                                              })
                                         }}
                                        </div>
                                    </td>
                                    {%endfor%}
                                    <td data-ng-init="{{promediopv}}={{ppval}}">
                                        {{'{{'}}{{promediopv}}{{'}}'}} 
                                    </td>
                                    {% if pactivo==3 %}
                                        
                                    <td data-ng-init="{{promediopt}}={{pptval}}">
                                           {{'{{'}}{{promediopt}}{{'}}'}}
                                    </td>
                                    <td data-ng-init="{{promediopt80}}=({{promediopt}}*0.8|number:2)">
                                           {{'{{'}}{{promediopt80}}{{'}}'}}
                                    </td>
                                    
                                    <td>
                                        {%set promediopv='PM'~nummat~'q'~qactivo~'P'~pactivo %}
                                        {%set exvar='q'~qactivo~'Ex' %}
                                        {%set exres='M'~nummat~exvar%}
                                        {%set exres20=exres~'V20'%}
                                        {%set promedioqv='PQ'~nummat~'q'~qactivo %}
                                        {{ form_widget(calificacion[exvar],
                                                {'attr':    {'ng-model':exres,
                                                             'ng-init':exres~'='~(calificacion[exvar].vars.value|replace(',','.')),
                                                             'ng-change':exres20~'='~exres~'*0.2;'~promedioqv~'='~exres20~'*1+1*'~promediopt80~';'
                                                            }
                                                    })
                                        }} 
                                    </td>
                                    
                                    <td data-ng-init="{{exres20}}={{exres}}*0.2">
                                        {{'{{'}}{{exres20}}{{'|number:2}}'}}
                                    </td>
                                    <td data-ng-init="{{promedioqv}}={{listado[loop.index0].getPromedioQuimestre(qactivo)}}">
                                        {{'{{'}}{{promedioqv}}{{'|number:2}}'}}
                                        
                                    </td>
                                    {% endif %}
                                </tr>    
                            {%endfor%}    
                            </tbody>
                        </table>


                            </div >
                        {# ... #}
                    {{ form_end(form) }}

              </div>
            </div><!-- /.panel-body -->
        </div><!-- /.panel -->
        <!--/ End inline form -->
    </div>
</div><!-- /.row -->
   
{% endblock %}
