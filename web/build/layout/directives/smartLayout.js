define(["layout/module","lodash"],function(a,b){"use strict";a.registerDirective("smartLayout",["$rootScope","$timeout","$interval","$q","SmartCss",function(a,c,d,e,f){var g=!1,h=e.defer();h.promise.then(function(){g=!0});var i,j,k,l,m=$(window),n=($(document),$("html")),o=$("body");return function p(){i=$("#header"),j=$("#left-panel"),k=$("#ribbon"),l=$(".page-footer"),b.every([i,j,k,l],function(a){return angular.isNumber(a.height())})?h.resolve():c(p,100)}(),{priority:2014,restrict:"A",compile:function(e,f){function p(){var b=o.hasClass("menu-on-top")&&j.is(":visible")?j.height():0,c=!o.hasClass("menu-on-top")&&j.is(":visible")?j.width()+j.offset().left:0,d=$("#content"),e=d.outerWidth(!0)-d.width(),f=d.outerHeight(!0)-d.height();v=m.width()-c-e,w=m.height()-b-f-i.height()-k.height()-l.height(),x=A-v,y=z-w,(Math.abs(x)||Math.abs(y)||B)&&(a.$broadcast("$smartContentResize",{width:v,height:w,deltaX:x,deltaY:y}),A=v,z=w,B=!1)}function q(a){h.promise.then(function(){s(a)})}function r(){C=!1}function s(a){c(function(){C=!0},a)}function t(){o.toggleClass("mobile-view-activated",m.width()<979),m.width()<979&&o.removeClass("minified"),p()}function u(a){a.data&&a.data.htmlId?n.attr("id",a.data.htmlId):n.removeAttr("id")}e.removeAttr("smart-layout data-smart-layout");var v,w,x,y,z=0,A=0,B=!1,C=!1;d(function(){C&&t()},300);var D=b.debounce(function(){q(300)},300);q(10),a.$on("$stateChangeStart",function(a,b,c,d,e){u(b),r()});var E=1;a.$on("$viewContentLoading",function(a,b){E++}),a.$on("$stateChangeSuccess",function(a,b,c,d,e){B=!0}),a.$on("$viewContentLoaded",function(a){E--,0==E&&g&&D()})}}}])});