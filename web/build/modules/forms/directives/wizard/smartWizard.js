define(["modules/forms/module","lodash"],function(a,b){"use strict";return a.registerDirective("smartWizard",function(){return{restrict:"A",scope:{smartWizardCallback:"&"},link:function(a,c,d){function e(a){g=a,$("[data-smart-wizard-pane="+a+"]",c).addClass("active").siblings("[data-smart-wizard-pane]").removeClass("active"),$("[data-smart-wizard-tab="+a+"]",c).addClass("active").siblings("[data-smart-wizard-tab]").removeClass("active"),j.toggleClass("disabled",1==a)}var f=$("[data-smart-wizard-tab]").length,g=1,h=[],i=c.closest("form"),j=$("[data-smart-wizard-prev]",c),k=$("[data-smart-wizard-next]",c);c.on("click","[data-smart-wizard-tab]",function(a){e(parseInt($(this).data("smartWizardTab"))),a.preventDefault()}),k.on("click",function(d){if(i.data("validator")){if(!i.valid())return h=b.without(h,g),i.data("validator").focusInvalid(),!1;h=b.without(h,g),h.push(g),c.find("[data-smart-wizard-tab="+g+"]").addClass("complete").find(".step").html('<i class="fa fa-check"></i>')}if(f>g)e(g+1);else if(h.length<f){var j=b.range(1,f+1);b(j).forEach(function(a){return-1==h.indexOf(a)?(console.log(a),e(a),!1):void 0})}else{var k={};b.each(i.serializeArray(),function(a){k[a.name]=a.value}),"function"==typeof a.smartWizardCallback()&&a.smartWizardCallback()(k)}d.preventDefault()}),j.on("click",function(a){!j.hasClass("disabled")&&g>0&&e(g-1),a.preventDefault()}),e(g)}}})});